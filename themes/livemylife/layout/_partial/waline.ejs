<!-- 1. 引入 Waline 官方 CSS -->
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />

<!-- 2. 容器 -->
<div id="waline"></div>

<!-- 3. 初始化脚本 -->
<script type="module">
  import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

  init({
    el: '#waline',
    serverURL: '<%= theme.waline.serverURL %>',
    placeholder: '<%= theme.waline.placeholder %>',
    avatar: '<%= theme.waline.avatar %>',
    pageSize: '<%= theme.waline.pageSize %>',
    visitor: <%= theme.waline.visitor %>,
    lang: '<%= config.language || "zh-CN" %>',
    /* 
       关键修正：
       不再用 'auto'，而是精确指定由 data-theme 属性控制。
       这样输入框就不会自己变黑了！
    */
    dark: 'html[data-theme="dark"]' 
  });
</script>

<!-- 4. 样式配置 -->
<style>
  /* === 基础布局 === */
  #waline {
    margin-top: 30px;
    padding: 10px;
  }

  /* 
   * =========================================
   * 区域 1：默认状态 (白天模式) - 强制定义
   * =========================================
   */
  :root {
    /* 1. 强制背景为纯白，修复输入框变黑的问题 */
    --waline-bgcolor: #ffffff;
    --waline-bgcolor-light: #f8f9fa;
    
    /* 2. 字体和主题色 */
    --waline-font-size: 16px;
    --waline-theme-color: #0085a1; 
    --waline-active-color: #0085a1;
    
    /* 3. 边框颜色 */
    --waline-border-color: #f0f0f0;
    
    /* 4. 标签颜色变量 (白天) */
    --waline-badge-color: #666666;      /* 文字深灰 */
    --waline-badge-bgcolor: #f2f2f2;    /* 背景浅灰 */
  }

  /* 
   * =========================================
   * 区域 2：强制覆盖标签样式 (解决黑块问题)
   * =========================================
   */
  /* 针对所有标签（浏览器、系统、博主标签） */
  .wl-meta-head .wl-badge {
    background-color: var(--waline-badge-bgcolor) !important;
    color: var(--waline-badge-color) !important;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 2px 6px;
    margin-right: 5px; 
    font-size: 12px;
  }

  /* 
   * =========================================
   * 区域 3：暗色模式 (Dark Mode) - 只有触发时才生效
   * =========================================
   */
  html[data-theme="dark"] {
    /* 1. 背景变深 */
    --waline-bgcolor: #232d38;
    --waline-bgcolor-light: #2d3b48;
    
    /* 2. 文字变亮 */
    --waline-color: #e0e0e0;
    
    /* 3. 标签变量重定义 (晚上) */
    --waline-badge-color: #cccccc;      /* 文字亮灰 */
    --waline-badge-bgcolor: #3b4b5b;    /* 背景深灰 */
    
    /* 4. 边框 */
    --waline-border-color: #444;
  }

  /* 暗色模式下微调标签边框 */
  html[data-theme="dark"] .wl-meta-head .wl-badge {
    border-color: #555;
  }
</style>